<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>영상 테스트 사이트</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; text-align: center; }
    .row { display:flex; gap:.5rem; justify-content:center; align-items:center; flex-wrap:wrap; }
    input[type="text"]{ flex:1 1 560px; max-width:720px; padding:.6rem; }
    button { padding:.6rem 1rem; border:none; border-radius:6px; cursor:pointer; }
    ul{ list-style:none; padding:0; margin-top:1rem; text-align:left; }
    li{ background:#f5f7fb; padding:.6rem .8rem; margin:.35rem 0; border-radius:6px; word-break:break-all; display:flex; gap:.5rem; align-items:center; }
    li a{ text-decoration:none; color:#333; flex:1 1 auto; }
    li .play{ white-space:nowrap; }
    video{ width:100%; max-width:720px; border-radius:8px; background:#000; margin-top:1rem; }
    small.note{ color:#666; display:block; margin-top:.5rem; }
  </style>
</head>
<body>
  <h1>영상 테스트 사이트</h1>

  <div class="row">
    <input id="videoUrl" type="text" placeholder="영상 주소를 입력하세요 (mp4 직링크 또는 구글드라이브 링크)" />
    <button id="addBtn">추가</button>
  </div>
  <small class="note">
    ※ 구글드라이브의 <code>open?id=...</code> 또는 <code>/file/d/파일ID/view</code> 형식은 자동으로
    <code>uc?id=...&export=download</code>로 변환합니다.
  </small>

  <h2>영상 목록</h2>
  <ul id="videoList"></ul>

  <video id="videoPlayer" controls autoplay loop playsinline preload="metadata" crossorigin="anonymous">
    브라우저가 video 태그를 지원하지 않습니다.
  </video>

  <script>
    const videoPlayer = document.getElementById('videoPlayer');
    const videoUrlInput = document.getElementById('videoUrl');
    const addBtn = document.getElementById('addBtn');
    const videoList = document.getElementById('videoList');

    // 구글드라이브 링크 → 재생 가능한 다운로드 링크로 변환
    function normalizeDriveUrl(url){
      try{
        const u = new URL(url);
        if (u.hostname === 'drive.google.com') {
          // 1) open?id=FILE_ID
          if (u.pathname === '/open' && u.searchParams.get('id')) {
            const id = u.searchParams.get('id');
            return `https://drive.google.com/uc?id=${id}&export=download`;
          }
          // 2) /file/d/FILE_ID/view 또는 /preview
          const fileMatch = u.pathname.match(/^\/file\/d\/([^/]+)\//);
          if (fileMatch && fileMatch[1]) {
            const id = fileMatch[1];
            return `https://drive.google.com/uc?id=${id}&export=download`;
          }
        }
      } catch(e){ /* invalid URL -> return as is */ }
      return url;
    }

    // 목록 데이터
    const videos = [
      // 샘플(문제 제시 링크들)
      "https://drive.google.com/uc?id=12HnY1WMwl1sEpJkoCcwyDB94gFcvOr_e&export=download",
      "https://drive.google.com/open?id=12HnY1WMwl1sEpJkoCcwyDB94gFcvOr_e&usp=drive_copy",
      "https://ksldict.korean.go.kr/kslserv/signFile/video/exmp/202405/WHxDCQroOMHr03EG.mp4",
      "https://drive.google.com/file/d/12HnY1WMwl1sEpJkoCcwyDB94gFcvOr_e/view?usp=drive_link"
    ].map(normalizeDriveUrl);

    function loadVideo(url){
      videoPlayer.src = url;
      // 에러 핸들링: 재생 실패 시 안내
      videoPlayer.onerror = () => {
        alert('이 URL은 직접 재생할 수 없습니다.\n- 구글드라이브는 공유 설정 "링크가 있는 모든 사용자" + 다운로드 링크(uc?id=...)가 필요합니다.\n- 또는 CORS가 허용된 mp4 직링크를 사용하세요.');
      };
      videoPlayer.load();
      videoPlayer.play().catch(()=>{ /* autoplay 차단 시 무시 */ });
    }

    function renderList(){
      videoList.innerHTML = '';
      videos.forEach((url, i)=>{
        const li = document.createElement('li');

        const a = document.createElement('a');
        a.href = url; a.target = '_blank'; a.textContent = url;

        const playBtn = document.createElement('button');
        playBtn.textContent = '재생';
        playBtn.className = 'play';
        playBtn.addEventListener('click', ()=> loadVideo(url));

        li.appendChild(a);
        li.appendChild(playBtn);
        videoList.appendChild(li);
      });
    }

    addBtn.addEventListener('click', ()=>{
      const raw = videoUrlInput.value.trim();
      if(!raw) return;
      const normalized = normalizeDriveUrl(raw);
      videos.push(normalized);
      renderList();
      videoUrlInput.value = '';
    });

    // 초기 렌더 & 첫 번째 항목 자동 재생
    renderList();
    if (videos.length) loadVideo(videos[0]);
  </script>
</body>
</html>
